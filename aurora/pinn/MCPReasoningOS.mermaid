graph TD

%% User & Entry
User(["ğŸ‘¤ User<br/>story / prompt / voice"]) -->|story| Freyja
Freyja(["ğŸ”· Freyja<br/>(interface + soul)"]) -->|call(OpenAI / initiate)| OpenAIAPI
Freyja -->|task| DeploymentAwareness

%% API Layer
OpenAIAPI["ğŸ§  OpenAI API"] --> QwenLLaMA
OpenAIAPI --> MCPValidator
OpenAIAPI --> ReasoningAdjuster

%% MCP and Reasoning
QwenLLaMA["ğŸŒ€ QwenLLaMA<br/>(FSM + recurrent reasoning)"] --> MCPValidator
QwenLLaMA --> ReasoningAdjuster

MCPValidator["âœ… MCP Validator<br/>alignment, legality, ethics"]
ReasoningAdjuster["ğŸ›ï¸ Reasoning Adjuster<br/>weights, corrections"]
ReasoningAdjuster -->|feedback from prompts| QwenLLaMA
ReasoningAdjuster -->|correction signals| MCPValidator
ReasoningAdjuster -->|memory delta| QwenLLaMA

%% Search + Routing
SearchRouter["ğŸ” Search Result Router"] --> QwenLLaMA
SearchRouter --> SemanticSearch
SearchRouter --> DeploymentAwareness

SemanticSearch["ğŸ” Semantic Search Engine"] --> QdrantStore
SemanticSearch --> ReasoningRegistry

%% Memory
QdrantStore["ğŸ—‚ QDrant Embeddings Store (local)"]
OpenAIEmbed["ğŸ“¦ OpenAI Embeddings API"] --> ReasoningLog
ReasoningLog["ğŸ“˜ Reasoning Log Storage<br/>(e.g., DynamoDB)"]

%% Orchestration
DeploymentAwareness["ğŸ“¡ Deployment Awareness"]
ReasoningRegistry["ğŸ§¾ Semantic Reasoning Registry"]
SearchResponseFSM["ğŸ§­ Search Response FSM"]
QueryReasoningHandler["ğŸ— Query Reasoning Handler"]

%% Flow labels
classDef tokenFlow stroke:#00bcd4,stroke-width:2px;
classDef controlFlow stroke:#e91e63,stroke-dasharray: 5,5;
classDef dataFlow stroke:#ff9800,stroke-width:2px;

class Freyja,OpenAIAPI,QwenLLaMA,MCPValidator,ReasoningAdjuster tokenFlow;
class SemanticSearch,SearchRouter,QdrantStore,OpenAIEmbed,ReasoningLog dataFlow;
class ReasoningRegistry,SearchResponseFSM,DeploymentAwareness,QueryReasoningHandler controlFlow;
